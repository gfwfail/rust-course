# ğŸ¦€ Rust å­¦ä¹ å°ç»„è¯¾ç¨‹ç¬”è®°

> æˆè¯¾æ—¶é—´ï¼š2026-02-14
> æˆè¯¾å¯¹è±¡ï¼šWeb ç¨‹åºå‘˜èƒŒæ™¯

---

## ç›®å½•

1. [Hello World ä¸åŸºç¡€æ¦‚å¿µ](#ç¬¬ä¸€è¯¾hello-world-ä¸åŸºç¡€æ¦‚å¿µ)
2. [å˜é‡ä¸æ•°æ®ç±»å‹](#ç¬¬äºŒè¯¾å˜é‡ä¸æ•°æ®ç±»å‹)
3. [æ‰€æœ‰æƒ Ownership](#ç¬¬ä¸‰è¯¾æ‰€æœ‰æƒ-ownership)
4. [ç”Ÿå‘½å‘¨æœŸ Lifetime](#ç¬¬å››è¯¾ç”Ÿå‘½å‘¨æœŸ-lifetime)
5. [é”™è¯¯å¤„ç†](#ç¬¬äº”è¯¾é”™è¯¯å¤„ç†)
6. [è®¾è®¡æ¨¡å¼](#ç¬¬å…­è¯¾rust-è®¾è®¡æ¨¡å¼)
7. [Q&A é—®ç­”æ•´ç†](#qa-é—®ç­”æ•´ç†)

---

## ç¬¬ä¸€è¯¾ï¼šHello World ä¸åŸºç¡€æ¦‚å¿µ

### Rust æ˜¯ä»€ä¹ˆï¼Ÿ

- **å†…å­˜å®‰å…¨**ï¼šç¼–è¯‘æœŸæ•è·å¤§éƒ¨åˆ†å†…å­˜é”™è¯¯ï¼Œæ²¡æœ‰ GC
- **é›¶æˆæœ¬æŠ½è±¡**ï¼šé«˜çº§ç‰¹æ€§ä¸ç‰ºç‰²æ€§èƒ½
- **å¹¶å‘å®‰å…¨**ï¼šç¼–è¯‘å™¨é˜²æ­¢æ•°æ®ç«äº‰

### å®‰è£…

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# éªŒè¯
rustc --version
cargo --version
```

### Hello World

```bash
cargo new hello_rust
cd hello_rust
cargo run
```

```rust
fn main() {
    println!("Hello, World!");
}
```

- `fn main()` â€” ç¨‹åºå…¥å£å‡½æ•°
- `println!` â€” å®ï¼ˆæ³¨æ„æ„Ÿå¹å· `!`ï¼‰ï¼Œä¸æ˜¯æ™®é€šå‡½æ•°
- è¯­å¥ç»“å°¾åŠ åˆ†å· `;`

---

## ç¬¬äºŒè¯¾ï¼šå˜é‡ä¸æ•°æ®ç±»å‹

### é»˜è®¤ä¸å¯å˜

```rust
let x = 5;
x = 6;  // âŒ ç¼–è¯‘é”™è¯¯ï¼
```

è¦å¯å˜ï¼ŒåŠ  `mut`ï¼š

```rust
let mut x = 5;
x = 6;  // âœ… OK
```

**ä»€ä¹ˆæ—¶å€™ç”¨ `mut`ï¼Ÿ**
- è®¡æ•°å™¨ã€ç´¯åŠ å™¨
- å¾ªç¯é‡Œè¦ä¿®æ”¹çš„çŠ¶æ€
- æ„å»ºä¸€ä¸ªä¸œè¥¿ï¼ˆæ‹¼å­—ç¬¦ä¸²ã€å¾€ Vec é‡Œ pushï¼‰

### åŸºæœ¬æ•°æ®ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| `i32` | é»˜è®¤æ•´æ•°ç±»å‹ |
| `i64` / `u64` | å¤§æ•´æ•° / æ•°æ®åº“ ID |
| `usize` | æ•°ç»„ç´¢å¼•ã€`.len()` |
| `f64` | é»˜è®¤æµ®ç‚¹ç±»å‹ |
| `bool` | true / false |
| `char` | Unicode å­—ç¬¦ |

### Shadowingï¼ˆå˜é‡é®è”½ï¼‰

```rust
let user_id = "123";           // &str
let user_id: u32 = user_id.parse().unwrap();  // é®è”½ä¸º u32
```

**ç”¨é€”**ï¼šæ•°æ®ç±»å‹è½¬æ¢ã€è®©æ—§ç‰ˆæœ¬æ•°æ®ä¸å¯è®¿é—®é˜²æ­¢è¯¯ç”¨

---

## ç¬¬ä¸‰è¯¾ï¼šæ‰€æœ‰æƒ Ownership

### ä¸‰æ¡é“å¾‹

1. æ¯ä¸ªå€¼æœ‰ä¸”åªæœ‰ä¸€ä¸ª ownerï¼ˆæ‰€æœ‰è€…ï¼‰
2. owner ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼è‡ªåŠ¨é”€æ¯
3. å€¼å¯ä»¥ moveï¼ˆè½¬ç§»ï¼‰æˆ– borrowï¼ˆå€Ÿç”¨ï¼‰

### Moveï¼ˆè½¬ç§»ï¼‰

```rust
let s1 = String::from("hello");
let s2 = s1;  // s1 çš„æ‰€æœ‰æƒ move ç»™ s2

println!("{}", s1);  // âŒ ç¼–è¯‘é”™è¯¯ï¼s1 æ²¡äº†
```

å‡½æ•°è°ƒç”¨ä¹Ÿä¼š moveï¼š

```rust
fn take_ownership(s: String) {
    println!("{}", s);
}

let my_string = String::from("hello");
take_ownership(my_string);  // æ‰€æœ‰æƒ move è¿›å‡½æ•°
println!("{}", my_string);  // âŒ ç¼–è¯‘é”™è¯¯ï¼
```

### Borrowï¼ˆå€Ÿç”¨ï¼‰

ä¸æƒ³ moveï¼Ÿç”¨å¼•ç”¨ï¼š

```rust
fn print_string(s: &String) {  // & è¡¨ç¤ºå€Ÿç”¨
    println!("{}", s);
}

let my_string = String::from("hello");
print_string(&my_string);  // å€Ÿç»™å‡½æ•°ç”¨
println!("{}", my_string);  // âœ… è¿˜èƒ½ç”¨
```

å¯å˜å€Ÿç”¨ï¼š

```rust
fn add_world(s: &mut String) {
    s.push_str(", world!");
}

let mut my_string = String::from("hello");
add_world(&mut my_string);
```

### å€Ÿç”¨è§„åˆ™

åŒä¸€æ—¶é—´åªèƒ½æœ‰ï¼š
- å¤šä¸ªä¸å¯å˜å¼•ç”¨ `&T`ï¼ˆéƒ½åªè¯»ï¼ŒOKï¼‰
- æˆ–ä¸€ä¸ªå¯å˜å¼•ç”¨ `&mut T`ï¼ˆåªæœ‰ä¸€ä¸ªäººå†™ï¼‰
- **ä¸èƒ½åŒæ—¶æœ‰ï¼**

---

## ç¬¬å››è¯¾ï¼šç”Ÿå‘½å‘¨æœŸ Lifetime

### è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

é˜²æ­¢æ‚¬å‚å¼•ç”¨ï¼ˆdangling referenceï¼‰ï¼š

```rust
let r;
{
    let x = 5;
    r = &x;
}  // x æ­»äº†
println!("{}", r);  // âŒ ç¼–è¯‘é”™è¯¯ï¼
```

### å¤§éƒ¨åˆ†æ—¶å€™ä¸ç”¨å†™

ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ï¼ˆç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼‰ã€‚

### ä»€ä¹ˆæ—¶å€™å¿…é¡»æ‰‹å†™ï¼Ÿ

ç¼–è¯‘å™¨æä¸æ¸…è¿”å›çš„å¼•ç”¨è·Ÿå“ªä¸ªè¾“å…¥æœ‰å…³ï¼š

```rust
fn longer<'a>(s1: &'a str, s2: &'a str) -> &'a str {
    if s1.len() > s2.len() { s1 } else { s2 }
}
```

`'a` çš„æ„æ€ï¼šè¿”å›å€¼ä¸ä¼šæ¯” s1 å’Œ s2 ä¸­è¾ƒçŸ­å‘½çš„é‚£ä¸ªæ´»å¾—æ›´ä¹…ã€‚

### ç»“æ„ä½“é‡Œå­˜å¼•ç”¨

```rust
struct Request<'a> {
    url: &'a str,
}
```

### 'static

æ´»å¾—å’Œç¨‹åºä¸€æ ·ä¹…ï¼š

```rust
let s: &'static str = "hello";  // å­—ç¬¦ä¸²å­—é¢é‡
```

---

## ç¬¬äº”è¯¾ï¼šé”™è¯¯å¤„ç†

### Rust æ²¡æœ‰ try-catch

é”™è¯¯å°±æ˜¯æ™®é€šçš„è¿”å›å€¼ã€‚

### Optionï¼šå¯èƒ½æœ‰å€¼ï¼Œå¯èƒ½æ²¡æœ‰

```rust
enum Option<T> {
    Some(T),
    None,
}

let numbers = vec![1, 2, 3];
match numbers.get(10) {
    Some(n) => println!("æ‰¾åˆ°: {}", n),
    None => println!("æ²¡æ‰¾åˆ°"),
}
```

### Resultï¼šå¯èƒ½æˆåŠŸï¼Œå¯èƒ½å¤±è´¥

```rust
enum Result<T, E> {
    Ok(T),
    Err(E),
}

match fs::read_to_string("config.json") {
    Ok(content) => println!("{}", content),
    Err(e) => println!("è¯»å–å¤±è´¥: {}", e),
}
```

### `?` æ“ä½œç¬¦

é”™è¯¯ä¼ æ’­ç¥å™¨ï¼š

```rust
fn get_user_name(id: u32) -> Result<String, DbError> {
    let conn = connect_db()?;       // å¤±è´¥ç›´æ¥è¿”å› Err
    let user = conn.find_user(id)?; // å¤±è´¥ç›´æ¥è¿”å› Err
    Ok(user.name)
}
```

### å¸¸ç”¨æ–¹æ³•

| æ–¹æ³• | ç”¨é€” |
|------|------|
| `unwrap()` | ç›´æ¥å–å€¼ï¼ŒNone/Err æ—¶ panic |
| `expect("msg")` | unwrap + è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ |
| `unwrap_or(default)` | ç»™é»˜è®¤å€¼ |
| `map()` | é“¾å¼è½¬æ¢ |

---

## ç¬¬å…­è¯¾ï¼šRust è®¾è®¡æ¨¡å¼

### æ ¸å¿ƒåŒºåˆ«ï¼šæ²¡æœ‰ä¼ ç»Ÿ OOP

Rust **æ²¡æœ‰ç»§æ‰¿**ï¼Œç”¨ç»„åˆ + Trait ä»£æ›¿ã€‚

### æ¨¡å¼1ï¼šç”¨ Enum ä»£æ›¿ç»§æ‰¿å±‚æ¬¡

```rust
enum Shape {
    Circle { radius: f64 },
    Rectangle { width: f64, height: f64 },
}

impl Shape {
    fn area(&self) -> f64 {
        match self {
            Shape::Circle { radius } => 3.14 * radius * radius,
            Shape::Rectangle { width, height } => width * height,
        }
    }
}
```

### æ¨¡å¼2ï¼šTrait ä»£æ›¿æ¥å£

```rust
trait Drawable {
    fn draw(&self);
}

impl Drawable for Circle {
    fn draw(&self) { ... }
}
```

**å¯ä»¥ç»™åˆ«äººçš„ç±»å‹å®ç° Traitï¼** Java/PHP åšä¸åˆ°ã€‚

### æ¨¡å¼3ï¼šBuilder æ¨¡å¼

Rust æ²¡æœ‰é»˜è®¤å‚æ•°ã€æ²¡æœ‰é‡è½½ï¼Œæ„é€ å¤æ‚å¯¹è±¡é  Builderï¼š

```rust
let server = ServerBuilder::new()
    .host("0.0.0.0")
    .port(3000)
    .build();
```

### æ¨¡å¼4ï¼šNewtype â€”â€” é˜²æ­¢ææ··

```rust
struct UserName(String);
struct Email(String);

fn create_user(name: UserName, email: Email) { ... }
// å†™åä¼šç¼–è¯‘é”™è¯¯
```

### æ¨¡å¼5ï¼šç±»å‹çŠ¶æ€ï¼ˆType Stateï¼‰

```rust
impl Order<Draft> {
    fn submit(self) -> Order<Submitted> { ... }
}

impl Order<Submitted> {
    fn pay(self) -> Order<Paid> { ... }
}

// Draft çŠ¶æ€è°ƒç”¨ pay() â†’ ç¼–è¯‘é”™è¯¯
```

### æ€ç»´è½¬å˜

| OOP æ€ç»´ | Rust æ€ç»´ |
|---------|----------|
| ç»§æ‰¿ | ç»„åˆ + Trait |
| ç±»å±‚æ¬¡ | Enum + match |
| è¿è¡Œæ—¶æ£€æŸ¥ | è®©é”™è¯¯ä»£ç ç¼–è¯‘ä¸è¿‡ |

---

## Q&A é—®ç­”æ•´ç†

### Q1: Borrow çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ

1. **ä¸ç”¨å¤åˆ¶ï¼Œçœå†…å­˜çœæ€§èƒ½**
   - ä¼  `&Vec<User>` åªä¼  8 å­—èŠ‚æŒ‡é’ˆï¼Œä¸å¤åˆ¶ 10 ä¸‡æ¡æ•°æ®

2. **ä¿æŒæ‰€æœ‰æƒï¼Œåé¢è¿˜èƒ½ç”¨**
   ```rust
   start_server(&config);
   start_worker(&config);  // è¿˜èƒ½ç”¨
   ```

3. **ç¼–è¯‘å™¨å¸®ä½ æŸ¥å¹¶å‘ bug**
   - æœ‰äººåœ¨è¯»çš„æ—¶å€™ä¸èƒ½å†™ï¼Œç¼–è¯‘æœŸå°±æ‹¦ä½

### Q2: å¤šçº¿ç¨‹æ•°æ®ç«äº‰æ€ä¹ˆè¯†åˆ«ï¼Ÿ

**ä¸æ˜¯"è¯†åˆ«"ï¼Œæ˜¯"æ ¹æœ¬ä¸è®©ä½ å†™å‡ºæ¥"ã€‚**

æ ¸å¿ƒæœºåˆ¶ï¼š`Send` å’Œ `Sync` è¿™ä¸¤ä¸ª Trait

- `Send`ï¼šç±»å‹å¯ä»¥å®‰å…¨åœ°ç§»åŠ¨åˆ°å¦ä¸€ä¸ªçº¿ç¨‹
- `Sync`ï¼šç±»å‹å¯ä»¥å®‰å…¨åœ°è¢«å¤šçº¿ç¨‹åŒæ—¶å¼•ç”¨

```rust
let rc = Rc::new(5);
thread::spawn(move || {
    println!("{:?}", rc);  // âŒ ç¼–è¯‘é”™è¯¯ï¼Rc æ²¡å®ç° Send
});
```

è¦è·¨çº¿ç¨‹å…±äº«å¿…é¡»ç”¨ `Arc<Mutex<T>>`ï¼Œç¼–è¯‘å™¨å¼ºåˆ¶ä½ åŠ é”ã€‚

### Q3: ç”Ÿå‘½å‘¨æœŸé˜²ä½ä»€ä¹ˆ Bugï¼Ÿ

| Bug ç±»å‹ | ç—‡çŠ¶ |
|---------|------|
| æ‚¬å‚æŒ‡é’ˆ | éšæœºå€¼/å´©æºƒ |
| Use After Free | è®¿é—®å·²é‡Šæ”¾å†…å­˜ |
| è¿­ä»£å™¨å¤±æ•ˆ | éå†æ—¶ä¿®æ”¹é›†åˆ |
| è¿”å›å†…éƒ¨å¼•ç”¨åä¿®æ”¹ | å¼•ç”¨æŒ‡å‘çš„æ•°æ®è¢«æ”¹äº† |

**å…±åŒç‰¹ç‚¹**ï¼šè¿è¡Œæ—¶æ‰ç‚¸ï¼Œè€Œä¸”ä¸æ˜¯æ¯æ¬¡éƒ½ç‚¸ã€‚

**Rust è§£æ³•**ï¼šå…¨éƒ¨å˜æˆç¼–è¯‘é”™è¯¯ã€‚

---

## å­¦ä¹ è·¯çº¿å»ºè®®

1. âœ… åŸºç¡€è¯­æ³•
2. âœ… æ‰€æœ‰æƒ / å€Ÿç”¨ / ç”Ÿå‘½å‘¨æœŸï¼ˆæ ¸å¿ƒï¼ï¼‰
3. âœ… é”™è¯¯å¤„ç†
4. âœ… è®¾è®¡æ¨¡å¼
5. â³ Struct / Enum / æ¨¡å¼åŒ¹é…
6. â³ Trait æ·±å…¥
7. â³ æ³›å‹
8. â³ å¹¶å‘ç¼–ç¨‹
9. â³ å¼‚æ­¥ç¼–ç¨‹ (async/await)
10. â³ å®æˆ˜é¡¹ç›®

---

*ç¬”è®°æ•´ç†ï¼šæ€§å¥´001*
*æœ€åæ›´æ–°ï¼š2026-02-14*
