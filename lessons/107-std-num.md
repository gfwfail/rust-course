# ç¬¬ 107 è¯¾ï¼šstd::num â€” æ•°å€¼ç±»å‹ä¸æ•°å­¦è¿ç®—

## ä¸ºä»€ä¹ˆè¦å­¦è¿™ä¸ªï¼Ÿ

æ¯ç§è¯­è¨€å¤„ç†æ•°å­—éƒ½æœ‰å‘ï¼š
- PHPï¼š`"10" + 5 = 15`ï¼ˆè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼‰
- JSï¼š`0.1 + 0.2 = 0.30000000000000004`ï¼ˆæµ®ç‚¹ç²¾åº¦ï¼‰
- Rustï¼šç¼–è¯‘æœŸå°±é€¼ä½ æƒ³æ¸…æ¥šæº¢å‡ºã€ç²¾åº¦ã€è½¬æ¢

**Rust çš„æ€åº¦**ï¼šä½ è¦çš„æ˜¯ä»€ä¹ˆæ•°å­—ï¼Ÿå¤šå¤§ï¼Ÿèƒ½æº¢å‡ºå—ï¼Ÿæƒ³æ¸…æ¥šå†å†™ï¼

---

## ä¸€ã€æ•´æ•°ç±»å‹ä¸€è§ˆ

```rust
// æœ‰ç¬¦å·ï¼ˆå¯ä»¥æ˜¯è´Ÿæ•°ï¼‰
i8    // -128 åˆ° 127
i16   // -32768 åˆ° 32767  
i32   // Â±21 äº¿ï¼ˆé»˜è®¤æ•´æ•°ç±»å‹ï¼‰
i64   // Â±922 äº¬
i128  // è¶…å¤§
isize // æŒ‡é’ˆå¤§å°ï¼ˆ64ä½ç³»ç»Ÿ = i64ï¼‰

// æ— ç¬¦å·ï¼ˆåªèƒ½æ˜¯æ­£æ•°æˆ– 0ï¼‰
u8    // 0 åˆ° 255ï¼ˆå­—èŠ‚ï¼ï¼‰
u16   // 0 åˆ° 65535
u32   // 0 åˆ° 42 äº¿
u64   // 0 åˆ° 1844 äº¬
u128  // è¶…å¤§
usize // æ•°ç»„ç´¢å¼•ç”¨è¿™ä¸ª
```

ğŸ’¡ **ç»éªŒæ³•åˆ™**ï¼š
- ä¸€èˆ¬æ•´æ•°ç”¨ `i32`
- æ•°ç»„ç´¢å¼•ç”¨ `usize`
- å­—èŠ‚/ASCII ç”¨ `u8`
- éœ€è¦éè´Ÿä¿è¯ç”¨ `u32/u64`

---

## äºŒã€æ•´æ•°çš„è¾¹ç•Œå€¼

```rust
println!("i8:  {} ~ {}", i8::MIN, i8::MAX);   // -128 ~ 127
println!("u8:  {} ~ {}", u8::MIN, u8::MAX);   // 0 ~ 255
println!("i32: {} ~ {}", i32::MIN, i32::MAX); // -2147483648 ~ 2147483647

// å¸¸ç”¨åœºæ™¯ï¼šåˆå§‹åŒ–æœ€å¤§/æœ€å°å€¼
let mut min_val = i32::MAX;
for &n in &[3, 1, 4, 1, 5] {
    if n < min_val {
        min_val = n;
    }
}
println!("æœ€å°å€¼: {}", min_val); // 1
```

---

## ä¸‰ã€æ•´æ•°æº¢å‡º â€” Rust çš„æ€åº¦

```rust
// Debug æ¨¡å¼ï¼šæº¢å‡ºä¼š panicï¼
let a: u8 = 255;
// let b = a + 1;  // ğŸ’¥ panic: attempt to add with overflow

// Release æ¨¡å¼ï¼šé»˜è®¤å›ç»•ï¼ˆwrap aroundï¼‰
// 255 + 1 = 0ï¼ˆu8ï¼‰
```

### æ˜¾å¼å¤„ç†æº¢å‡ºçš„æ–¹æ³•

```rust
let x: u8 = 250;

// 1. checked â€” æº¢å‡ºè¿”å› None
x.checked_add(10)   // Noneï¼ˆè¶…å‡ºäº†ï¼‰
x.checked_add(3)    // Some(253)

// 2. saturating â€” é¥±å’Œï¼Œåˆ°è¾¹ç•Œå°±åœ
x.saturating_add(10)  // 255ï¼ˆä¸è¶…è¿‡æœ€å¤§å€¼ï¼‰
x.saturating_sub(300) // 0ï¼ˆä¸ä½äºæœ€å°å€¼ï¼‰

// 3. wrapping â€” æ˜ç¡®è¦å›ç»•
x.wrapping_add(10)    // 4ï¼ˆ250 + 10 = 260 â†’ 260 - 256 = 4ï¼‰

// 4. overflowing â€” è¿”å› (ç»“æœ, æ˜¯å¦æº¢å‡º)
x.overflowing_add(10) // (4, true)
x.overflowing_add(3)  // (253, false)
```

ğŸ’¡ **å®æˆ˜å»ºè®®**ï¼š
- ç”¨æˆ·è¾“å…¥/å¤–éƒ¨æ•°æ® â†’ `checked_*` + é”™è¯¯å¤„ç†
- æ¸¸æˆåˆ†æ•°/è¿›åº¦æ¡ â†’ `saturating_*`
- å“ˆå¸Œ/åŠ å¯†ç®—æ³• â†’ `wrapping_*`

---

## å››ã€æµ®ç‚¹æ•°

```rust
f32  // å•ç²¾åº¦ï¼Œçº¦ 7 ä½æœ‰æ•ˆæ•°å­—
f64  // åŒç²¾åº¦ï¼Œçº¦ 15 ä½æœ‰æ•ˆæ•°å­—ï¼ˆé»˜è®¤ï¼‰

let pi: f64 = 3.14159265358979;
let e = 2.71828_f32;  // åç¼€æŒ‡å®šç±»å‹
```

### ç‰¹æ®Šå€¼

```rust
let inf = f64::INFINITY;         // æ­£æ— ç©·
let neg_inf = f64::NEG_INFINITY; // è´Ÿæ— ç©·
let nan = f64::NAN;              // Not a Number

// NaN çš„å¥‡æ€ªæ€§è´¨ï¼šå®ƒä¸ç­‰äºä»»ä½•å€¼ï¼ŒåŒ…æ‹¬è‡ªå·±
let nan = f64::NAN;
println!("{}", nan == nan);      // falseï¼
println!("{}", nan.is_nan());    // trueï¼ˆç”¨è¿™ä¸ªåˆ¤æ–­ï¼‰
```

### å¸¸ç”¨æ–¹æ³•

```rust
let x = -3.7_f64;

x.abs()       // 3.7ï¼ˆç»å¯¹å€¼ï¼‰
x.ceil()      // -3.0ï¼ˆå‘ä¸Šå–æ•´ï¼‰
x.floor()     // -4.0ï¼ˆå‘ä¸‹å–æ•´ï¼‰
x.round()     // -4.0ï¼ˆå››èˆäº”å…¥ï¼‰
x.trunc()     // -3.0ï¼ˆæˆªæ–­å°æ•°ï¼‰
x.fract()     // -0.7ï¼ˆå°æ•°éƒ¨åˆ†ï¼‰
x.signum()    // -1.0ï¼ˆç¬¦å·ï¼‰

let y = 2.0_f64;
y.sqrt()      // 1.414...ï¼ˆå¹³æ–¹æ ¹ï¼‰
y.powi(3)     // 8.0ï¼ˆæ•´æ•°æ¬¡å¹‚ï¼‰
y.powf(0.5)   // 1.414...ï¼ˆæµ®ç‚¹æ¬¡å¹‚ï¼‰
y.ln()        // 0.693...ï¼ˆè‡ªç„¶å¯¹æ•°ï¼‰
y.log10()     // 0.301...ï¼ˆä»¥ 10 ä¸ºåº•ï¼‰
y.exp()       // 7.389...ï¼ˆe^yï¼‰
```

---

## äº”ã€ç±»å‹è½¬æ¢

```rust
// as â€” æœ€ç›´æ¥ï¼Œä½†è¦å°å¿ƒæˆªæ–­
let big: i64 = 1000;
let small: i32 = big as i32;  // OK
let tiny: i8 = big as i8;     // å±é™©ï¼æˆªæ–­ä¸º -24

// æ¨èï¼šç”¨ try_from/try_into
use std::convert::TryFrom;

let big: i64 = 1000;
let result = i8::try_from(big);  // Errï¼ˆè¶…å‡ºèŒƒå›´ï¼‰

match result {
    Ok(n) => println!("è½¬æ¢æˆåŠŸ: {}", n),
    Err(_) => println!("æ•°å€¼è¶…å‡º i8 èŒƒå›´"),
}

// æµ®ç‚¹è½¬æ•´æ•°
let f = 3.7_f64;
let i = f as i32;  // 3ï¼ˆæˆªæ–­ï¼Œä¸æ˜¯å››èˆäº”å…¥ï¼ï¼‰
let i = f.round() as i32;  // 4ï¼ˆå…ˆå››èˆäº”å…¥ï¼‰
```

---

## å…­ã€è§£æå­—ç¬¦ä¸²ä¸ºæ•°å­—

```rust
// parse â€” æœ€å¸¸ç”¨
let s = "42";
let n: i32 = s.parse().unwrap();         // 42
let n = s.parse::<i32>().unwrap();       // turbofish è¯­æ³•

// å¤„ç†é”™è¯¯
let s = "not a number";
match s.parse::<i32>() {
    Ok(n) => println!("è§£ææˆåŠŸ: {}", n),
    Err(e) => println!("è§£æå¤±è´¥: {}", e),
}

// å„ç§è¿›åˆ¶
let hex = i32::from_str_radix("FF", 16).unwrap();  // 255
let bin = i32::from_str_radix("1010", 2).unwrap(); // 10
let oct = i32::from_str_radix("77", 8).unwrap();   // 63
```

---

## ä¸ƒã€ä½æ“ä½œ

```rust
let a: u8 = 0b1010_1010;  // 170
let b: u8 = 0b1111_0000;  // 240

a & b    // 0b1010_0000 = 160ï¼ˆANDï¼‰
a | b    // 0b1111_1010 = 250ï¼ˆORï¼‰
a ^ b    // 0b0101_1010 = 90ï¼ˆXORï¼‰
!a       // 0b0101_0101 = 85ï¼ˆNOTï¼‰

a << 1   // 0b0101_0100 = 84ï¼ˆå·¦ç§»ï¼Œç­‰äº Ã—2ï¼‰
a >> 1   // 0b0101_0101 = 85ï¼ˆå³ç§»ï¼Œç­‰äº Ã·2ï¼‰

// å®ç”¨æ–¹æ³•
let n: u32 = 0b1010_1100;
n.count_ones()      // 4ï¼ˆ1 çš„ä¸ªæ•°ï¼‰
n.count_zeros()     // 28ï¼ˆ0 çš„ä¸ªæ•°ï¼‰
n.leading_zeros()   // 24ï¼ˆå‰å¯¼ 0ï¼‰
n.trailing_zeros()  // 2ï¼ˆå°¾éš 0ï¼‰
n.reverse_bits()    // ä½åè½¬
n.rotate_left(2)    // å¾ªç¯å·¦ç§»
n.is_power_of_two() // false
```

---

## å…«ã€NonZero åŒ…è£…ç±»å‹

```rust
use std::num::NonZeroU32;

// ä¿è¯å€¼ä¸ä¸º 0 çš„ç±»å‹
let n = NonZeroU32::new(42);   // Some(NonZeroU32)
let z = NonZeroU32::new(0);    // None

// ç”¨é€”ï¼šOption<NonZeroU32> å’Œ u32 å ç”¨ç›¸åŒå†…å­˜ï¼
// å› ä¸º 0 å¯ä»¥è¡¨ç¤º Noneï¼Œç¼–è¯‘å™¨åšäº†ä¼˜åŒ–

use std::mem::size_of;
println!("{}", size_of::<u32>());                    // 4
println!("{}", size_of::<Option<u32>>());            // 8ï¼ˆå¤šäº† tagï¼‰
println!("{}", size_of::<Option<NonZeroU32>>());     // 4ï¼ˆé›¶æˆæœ¬ï¼ï¼‰
```

---

## ä»Šæ—¥å°ç»“

| åœºæ™¯ | æ¨èåšæ³• |
|------|---------|
| ä¸€èˆ¬æ•´æ•° | `i32` |
| æ•°ç»„ç´¢å¼• | `usize` |
| å­—èŠ‚æ•°æ® | `u8` |
| é˜²æ­¢æº¢å‡º | `checked_add()` |
| é™åˆ¶èŒƒå›´ | `saturating_add()` |
| å­—ç¬¦ä¸²è½¬æ•°å­— | `parse::<T>()` |
| å®‰å…¨ç±»å‹è½¬æ¢ | `TryFrom` |
| éœ€è¦éé›¶ä¿è¯ | `NonZeroU32` |

---

## è¯¾åç»ƒä¹ 

å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®‰å…¨åœ°å°†ç”¨æˆ·è¾“å…¥è½¬æ¢ä¸º 1-100 çš„åˆ†æ•°ï¼š

```rust
fn parse_score(input: &str) -> Result<u8, String> {
    // 1. è§£æä¸ºæ•°å­—
    let n: i32 = input.parse()
        .map_err(|_| format!("'{}' ä¸æ˜¯æœ‰æ•ˆæ•°å­—", input))?;
    
    // 2. æ£€æŸ¥èŒƒå›´ 1-100
    if n < 1 {
        return Err("åˆ†æ•°ä¸èƒ½å°äº 1".to_string());
    }
    if n > 100 {
        return Err("åˆ†æ•°ä¸èƒ½å¤§äº 100".to_string());
    }
    
    // 3. å®‰å…¨è½¬æ¢ä¸º u8
    Ok(n as u8)
}

// æµ‹è¯•
fn main() {
    assert_eq!(parse_score("85"), Ok(85));
    assert!(parse_score("0").is_err());
    assert!(parse_score("101").is_err());
    assert!(parse_score("abc").is_err());
    println!("æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼");
}
```

---

*ä¸‹èŠ‚è¯¾è§ï¼ğŸ¦€*
